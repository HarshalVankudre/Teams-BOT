================================================================================
SEMA CHATBOT - PROMPT ENGINEERING CHEATSHEET
================================================================================
Quick reference for reliable AI agent responses
================================================================================

## üéØ KEY PRINCIPLES FOR RELIABILITY

1. **LOW TEMPERATURE for facts** (0.0-0.1)
2. **HIGH SPECIFICITY in prompts** (exact rules, not vague guidelines)
3. **FEW-SHOT EXAMPLES** (show, don't just tell)
4. **VALIDATION STEPS** (check before responding)
5. **DOMAIN KNOWLEDGE** (inject context about construction equipment)

================================================================================
## üìä TEMPERATURE SETTINGS
================================================================================

| Task | Temperature | Reason |
|------|-------------|--------|
| Query Classification | 0.0-0.1 | Deterministic routing |
| SQL Generation | 0.0 | Exact syntax required |
| Factual Response | 0.2-0.3 | Slight variation OK |
| Recommendations | 0.4-0.5 | Creative but grounded |
| Scenarios | 0.5-0.6 | Reasoning flexibility |

================================================================================
## üîß SYSTEM PROMPT TEMPLATE
================================================================================

```
Du bist SEMA-GPT, ein KI-Assistent f√ºr die Baumaschinenflotte von R√úKO GmbH.

## FAKTEN (aus Datenbank - NIEMALS ERFINDEN):
- Gesamtbestand: 2.395 Ger√§te
- Bagger: 153, Fertiger: 107, Walzen: 156
- Top-Hersteller: Liebherr (677), V√∂gele (283), Caterpillar (144)

## REGELN:
1. NIEMALS Zahlen erfinden
2. Bei Unsicherheit: "Ich bin nicht sicher, lassen Sie mich nachschauen"
3. Immer Quelle angeben (Datenbank-Abfrage)
4. Konkrete Maschinennamen und Daten nennen
5. Bei Empfehlungen: BEGR√úNDUNG geben

## ANTWORT-STIL:
- Pr√§zise und direkt
- Deutsche Sprache
- Strukturiert bei Listen
- Professionell aber freundlich
```

================================================================================
## üìù QUERY CLASSIFIER PROMPT
================================================================================

```
Klassifiziere die Anfrage in EINE Kategorie:

AGGREGATION: Z√§hlen, Summen, Max/Min, Durchschnitte
‚Üí "Wie viele...", "Was ist der schwerste...", "Durchschnitt..."

FILTER: Listen mit Bedingungen
‚Üí "Welche haben...", "Zeige alle mit...", "Ger√§te √ºber..."

COMPARISON: Vergleiche zwischen Typen
‚Üí "Vergleiche...", "Unterschied zwischen...", "vs"

LOOKUP: Spezifisches Ger√§t finden
‚Üí "Zeige mir den...", "Details zu...", Modellnummern

SEMANTIC: Empfehlungen, Eignung f√ºr Aufgaben
‚Üí "Was eignet sich f√ºr...", "Empfehlung f√ºr...", "Was brauche ich..."

Ausgabe: {"type": "...", "confidence": 0.X}
```

================================================================================
## üîç SQL GENERATION RULES
================================================================================

### IMMER:
```sql
-- Case-insensitive Vergleiche
WHERE hersteller ILIKE 'caterpillar'

-- NULL-Check vor numerisch
WHERE gewicht_kg IS NOT NULL AND gewicht_kg > 20000

-- Bagger: beide Spalten
WHERE kategorie = 'bagger' OR geraetegruppe ILIKE '%bagger%'

-- Einheiten umrechnen (Tonnen ‚Üí kg)
-- "20 Tonnen" ‚Üí gewicht_kg > 20000

-- Listen limitieren
LIMIT 20
```

### NIEMALS:
```sql
-- Case-sensitive (FALSCH!)
WHERE hersteller = 'Caterpillar'

-- Ohne NULL-check (FALSCH!)
WHERE gewicht_kg > 20000

-- SELECT * ohne LIMIT (FALSCH!)
SELECT * FROM geraete
```

================================================================================
## üìö FEW-SHOT EXAMPLES TEMPLATE
================================================================================

F√ºge 3-5 Beispiele zu jedem Prompt hinzu:

```
## BEISPIELE:

Frage: "Wie viele Bagger haben wir?"
‚Üí Typ: AGGREGATION
‚Üí SQL: SELECT geraetegruppe, COUNT(*) FROM geraete WHERE...
‚Üí Antwort: "Wir haben **153 Bagger** im Bestand..."

Frage: "Welche Maschine f√ºr Stra√üenbau?"
‚Üí Typ: SEMANTIC
‚Üí Antwort: "F√ºr Stra√üenbau empfehle ich: 1. Fertiger... 2. Walzen..."
```

================================================================================
## ‚úÖ VALIDATION CHECKLIST
================================================================================

Vor jeder Antwort pr√ºfen:

‚ñ° Alle Zahlen aus Datenbank? (nicht erfunden)
‚ñ° Einheiten korrekt? (kg, kW, m)
‚ñ° Frage direkt beantwortet?
‚ñ° Bei Empfehlungen: Begr√ºndung dabei?
‚ñ° Keine Widerspr√ºche zu bekannten Fakten?

================================================================================
## üö´ COMMON MISTAKES TO AVOID
================================================================================

| Mistake | Fix |
|---------|-----|
| Zahlen erfinden | IMMER aus DB abfragen |
| Vage Antworten ("viele Bagger") | Exakte Zahlen ("153 Bagger") |
| Empfehlung ohne Begr√ºndung | "...weil es f√ºr X geeignet ist" |
| Case-sensitive SQL | ILIKE statt = |
| Fehlende NULL-checks | IS NOT NULL AND ... |
| Zu lange Antworten | Auf Frage fokussieren |

================================================================================
## üîÑ CHAIN-OF-THOUGHT FOR COMPLEX QUERIES
================================================================================

F√ºr Szenario-Fragen, f√ºge hinzu:

```
Denke Schritt f√ºr Schritt:
1. Was sind die Anforderungen?
2. Welche Einschr√§nkungen gibt es?
3. Welche Maschinen passen?
4. Welche scheiden aus und warum?
5. Was ist die beste Empfehlung?
```

================================================================================
## üìä RESPONSE FORMAT TEMPLATES
================================================================================

### F√ºr Z√§hlungen:
```
Wir haben **[ZAHL] [GER√ÑTETYP]** im Bestand:
- [Untertyp 1]: [Anzahl]
- [Untertyp 2]: [Anzahl]
```

### F√ºr Vergleiche:
```
| Typ | Anzahl | √ò Gewicht |
|-----|--------|-----------|
| [Typ A] | X | Y kg |
| [Typ B] | X | Y kg |

[Kurze Schlussfolgerung]
```

### F√ºr Empfehlungen:
```
F√ºr **[AUFGABE]** empfehle ich:

**1. [Maschinentyp]** ([Anzahl] verf√ºgbar)
- Beispiel: [Konkretes Modell]
- Grund: [Warum geeignet]

**Alternativen:** [Falls Hauptempfehlung nicht passt]
```

### F√ºr Lookup:
```
**[Hersteller] [Modell]**

| Eigenschaft | Wert |
|-------------|------|
| Gewicht | X kg |
| Leistung | Y kW |
| Abgasstufe | Z |
```

================================================================================
## üõ°Ô∏è ERROR HANDLING TEMPLATES
================================================================================

### Keine Ergebnisse:
```
F√ºr "[Suchbegriff]" wurden keine Ger√§te gefunden.

M√∂gliche Gr√ºnde:
- [Grund 1]
- [Grund 2]

Versuchen Sie: [Alternative Suche]
```

### Unklare Anfrage:
```
Ich verstehe die Anfrage nicht vollst√§ndig.

Bitte formulieren Sie um, z.B.:
- "Wie viele [Ger√§tetyp] haben wir?"
- "Welche Ger√§te haben [Eigenschaft]?"
```

================================================================================
## üîß IMPLEMENTATION TIPS
================================================================================

1. **Use JSON mode for classification:**
   ```python
   response_format={"type": "json_object"}
   ```

2. **Separate models by task:**
   - gpt-4o-mini: Classification (fast, cheap)
   - gpt-4o: SQL + Response (accurate)

3. **Log everything:**
   - Query ‚Üí Classification ‚Üí SQL ‚Üí Result ‚Üí Response
   - Helps identify failure patterns

4. **Implement retry logic:**
   - If SQL fails, try simpler query
   - If classification unclear, ask for clarification

5. **Cache common queries:**
   - "Wie viele Bagger?" always same answer
   - Update cache on DB changes

================================================================================
## üìà CONTINUOUS IMPROVEMENT
================================================================================

1. **Collect feedback** (thumbs up/down on responses)
2. **Review failed queries** weekly
3. **Add new few-shot examples** from real user questions
4. **Update domain knowledge** when equipment changes
5. **A/B test prompt changes** before deploying

================================================================================
